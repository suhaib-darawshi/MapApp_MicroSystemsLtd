{"version":3,"file":"MariadbDatasource.js","sourceRoot":"src/","sources":["datasources/MariadbDatasource.ts"],"names":[],"mappings":";;;AAAA,iCAA0C;AAC1C,qCAAmC;AACnC,yCAAoC;AACpC,mDAAmD;AAEtC,QAAA,mBAAmB,GAAG,MAAM,CAAC,GAAG,CAAC,mBAAmB,CAAC,CAAC;AACtD,QAAA,iBAAiB,GAAG,IAAI,oBAAU,CAAC;IAC9C,IAAI,EAAE,SAAS;IACf,QAAQ,EAAE,CAAC,sBAAW,CAAC;IACvB,IAAI,EAAC,OAAO,CAAC,GAAG,CAAC,OAAO,IAAG,WAAW;IACtC,IAAI,EAAC,QAAQ,CAAC,OAAO,CAAC,GAAG,CAAC,OAAO,IAAE,MAAM,CAAC;IAC1C,QAAQ,EAAC,OAAO,CAAC,GAAG,CAAC,OAAO,IAAG,UAAU;IACzC,QAAQ,EAAC,OAAO,CAAC,GAAG,CAAC,WAAW,IAAG,KAAK;IACxC,QAAQ,EAAC,OAAO,CAAC,GAAG,CAAC,gBAAgB,IAAG,SAAS;IACjD,WAAW,EAAE,IAAI;CAClB,CAAC,CAAC;AAEH,IAAA,qBAAgB,EAAa;IAC3B,OAAO,EAAE,2BAAmB;IAC5B,IAAI,EAAE,oBAAoB;IAC1B,IAAI,EAAE,CAAC,eAAM,CAAC;IACd,KAAK,CAAC,eAAe,CAAC,MAAc;QAClC,MAAM,yBAAiB,CAAC,UAAU,EAAE,CAAC;QAErC,MAAM,CAAC,IAAI,CAAC,6CAA6C,CAAC,CAAC;QAC3D,OAAO,yBAAiB,CAAC;IAC3B,CAAC;IACD,KAAK,EAAE;QACL,UAAU,CAAC,UAAU;YACnB,OAAO,UAAU,CAAC,aAAa,IAAI,UAAU,CAAC,KAAK,EAAE,CAAC;QACxD,CAAC;KACF;CACF,CAAC,CAAC","sourcesContent":["import {registerProvider} from \"@tsed/di\";\nimport {DataSource} from \"typeorm\";\nimport {Logger} from \"@tsed/logger\";\nimport { MapLocation } from \"../entities/location\";\n\nexport const MARIADB_DATA_SOURCE = Symbol.for(\"MariadbDataSource\");\nexport const MariadbDataSource = new DataSource({\n  type: \"mariadb\",\n  entities: [MapLocation],\n  host:process.env.DB_HOST?? \"localhost\",\n  port:parseInt(process.env.DB_PORT??\"3306\"),\n  username:process.env.DB_USER?? \"map_user\",\n  password:process.env.DB_PASSWORD?? \"123\",\n  database:process.env.DP_DATABASE_NAME?? \"map_app\",\n  synchronize: true,\n});\n\nregisterProvider<DataSource>({\n  provide: MARIADB_DATA_SOURCE,\n  type: \"typeorm:datasource\",\n  deps: [Logger],\n  async useAsyncFactory(logger: Logger) {\n    await MariadbDataSource.initialize();\n\n    logger.info(\"Connected with typeorm to database: Mariadb\");\n    return MariadbDataSource;\n  },\n  hooks: {\n    $onDestroy(dataSource) {\n      return dataSource.isInitialized && dataSource.close();\n    }\n  }\n});\n"]}